<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">

    <!-- MOBILE RESPONSIVENESS -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta name="author" content="Lwandiso Nunu">
    <title>Apply for Tutoring | Lwandiso Nunu</title>

    <link rel="stylesheet" href="style.css">

    <!-- jsPDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <!-- MOBILE FORM STYLES -->
    <style>
        section {
            max-width: 500px;
            margin: auto;
            padding: 20px;
        }

        form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        input,
        select,
        textarea,
        button {
            padding: 12px;
            font-size: 16px;
            width: 100%;
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        .summary {
            background: #f4f4f4;
            padding: 15px;
            border-radius: 8px;
            font-size: 15px;
            margin-bottom: 15px;
        }

        .summary strong {
            display: block;
            margin-bottom: 5px;
        }

        button {
            background: #111;
            color: white;
            border: none;
            cursor: pointer;
        }

        button:hover {
            opacity: 0.9;
        }

        @media (max-width: 480px) {
            h2 {
                font-size: 22px;
                text-align: center;
            }
        }
    </style>
</head>

<body>

<!-- NAV -->
<nav>
    <h1>Math & Science Tutor</h1>

    <button class="menu-toggle" onclick="toggleMenu()">â˜°</button>

    <ul id="navMenu">
        <li><a href="index.html">Home</a></li>
    </ul>

    <button id="darkModeToggle">ðŸŒ™</button>
</nav>

<!-- APPLY -->
<section>
    <h2>Apply for Tutoring</h2>

    <!-- BOOKING SUMMARY -->
    <div class="summary">
        <strong>Booking Summary</strong>
        <p><strong>Package:</strong> <span id="pkgText">Not selected</span></p>
        <p><strong>Time Slot:</strong> <span id="slotText">Not selected</span></p>
        <p><strong>Total Amount:</strong> R<span id="priceText">0</span></p>
        <p><strong>Payment Status:</strong> Pending</p>
    </div>

    <form onsubmit="generateInvoice(event)">
        <input type="text" name="Full Name" placeholder="Full Name" required>
        <input type="email" name="Email" placeholder="Email Address" required>
        <input type="tel" name="Phone" placeholder="Phone Number" required>

        <textarea name="Address" placeholder="Residential Address" required></textarea>

        <select name="Subject" required>
            <option value="">Select Subject</option>
            <option>Mathematics</option>
            <option>Physical Sciences</option>
            <option>Computer Science</option>
            <option>Ethical Hacking</option>
        </select>

        <select name="Package" required onchange="updatePackage(this)">
            <option value="">Select Package</option>
            <option value="Hourly" data-price="50">Hourly â€“ R50</option>
            <option value="Starter" data-price="350">Starter â€“ R350</option>
            <option value="Standard" data-price="400">Standard â€“ R400</option>
            <option value="Intensive" data-price="700">Intensive â€“ R700</option>
        </select>

        <textarea placeholder="Additional information (grade, goals, etc.)"></textarea>

        <button type="submit">Submit Booking & Download Invoice</button>
    </form>
</section>

<footer>
    <p>Â© 2025 Math & Science Tutor</p>
</footer>

<script src="script.js"></script>

<script>
/* LOAD SAVED DATA */
const savedPkg = localStorage.getItem("selectedPackage");
const savedPrice = localStorage.getItem("selectedPrice");
const savedSlot = localStorage.getItem("selectedSlot");

if (savedPkg) document.getElementById("pkgText").innerText = savedPkg;
if (savedPrice) document.getElementById("priceText").innerText = savedPrice;
if (savedSlot) document.getElementById("slotText").innerText = savedSlot;

/* UPDATE PACKAGE */
function updatePackage(select) {
    const option = select.options[select.selectedIndex];
    const pkg = option.value;
    const price = option.dataset.price;

    localStorage.setItem("selectedPackage", pkg);
    localStorage.setItem("selectedPrice", price);

    document.getElementById("pkgText").innerText = pkg;
    document.getElementById("priceText").innerText = price;
}

/* GENERATE PDF + EMAIL */
function generateInvoice(e) {
    e.preventDefault();

    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF();

    const name = document.querySelector('[name="Full Name"]').value;
    const email = document.querySelector('[name="Email"]').value;
    const phone = document.querySelector('[name="Phone"]').value;
    const address = document.querySelector('[name="Address"]').value;
    const subject = document.querySelector('[name="Subject"]').value;

    const pkg = localStorage.getItem("selectedPackage") || "Not Selected";
    const price = localStorage.getItem("selectedPrice") || "0";
    const slot = localStorage.getItem("selectedSlot") || "Not Selected";
    const date = new Date().toLocaleDateString();
    const invoiceNumber = "INV-" + Date.now();

    /* SAVE BOOKED SLOT */
    let bookedSlots = JSON.parse(localStorage.getItem("bookedSlots")) || [];
    bookedSlots.push(slot);
    localStorage.setItem("bookedSlots", JSON.stringify(bookedSlots));

    /* PDF HEADER */
    pdf.setFillColor(17, 17, 17);
    pdf.rect(0, 0, 210, 30, "F");

    pdf.setTextColor(255, 255, 255);
    pdf.setFontSize(18);
    pdf.text("Tutoring Invoice", 105, 20, { align: "center" });

    pdf.setTextColor(0, 0, 0);
    pdf.setFontSize(12);

    let y = 45;
    pdf.text(`Invoice No: ${invoiceNumber}`, 20, y); y += 10;
    pdf.text(`Date: ${date}`, 20, y); y += 10;
    pdf.text(`Student: ${name}`, 20, y); y += 10;
    pdf.text(`Email: ${email}`, 20, y); y += 10;
    pdf.text(`Phone: ${phone}`, 20, y); y += 10;
    pdf.text(`Address: ${address}`, 20, y, { maxWidth: 170 }); y += 15;
    pdf.text(`Subject: ${subject}`, 20, y); y += 10;
    pdf.text(`Package: ${pkg}`, 20, y); y += 10;
    pdf.text(`Time Slot: ${slot}`, 20, y); y += 10;
    pdf.text(`Payment Status: Pending`, 20, y); y += 15;

    pdf.setFontSize(14);
    pdf.text(`TOTAL: R${price}`, 20, y);

    pdf.save(`Invoice_${invoiceNumber}.pdf`);

    /* EMAIL CONTENT */
    const body =
`New Tutoring Booking

Invoice: ${invoiceNumber}
Date: ${date}

Student: ${name}
Email: ${email}
Phone: ${phone}
Address: ${address}

Subject: ${subject}
Package: ${pkg}
Time Slot: ${slot}
Total Amount: R${price}

Payment Status: Pending`;

    window.location.href =
        "mailto:s217477089@mandela.ac.za" +
        "?subject=" + encodeURIComponent("New Tutoring Booking â€“ " + invoiceNumber) +
        "&body=" + encodeURIComponent(body);
}

/* MOBILE MENU */
function toggleMenu() {
    document.getElementById("navMenu").classList.toggle("show");
}
</script>

</body>
</html>
